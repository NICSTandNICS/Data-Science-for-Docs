---
title: "Data Wrangling"
author: "Ahmed Al-Hindawi"
date: "29/11/2016"
output: ioslides_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Learning Objectives

- Use the dplyr package to manipulate your data
- The standard R methods for selecting data
- Some of our favourite (data wrangling) things
    + Wrangling strings
    + Wrangling dates
    + Columns to rows and back again


## Prerequisite

- Install 'dplyr' + 'lubridate' + 'stringr'
- Import them into a new worksheet
- Import the RCT dataset into a 'ddata' variable

## First wrangle!

Type this into the console:
```{r, eval = FALSE, echo= TRUE}
filter(ddata, is.na(Age) == FALSE, Age >= 65)
```

Done! It _filters_ rows from the `ddata` data frame where `Age` is NOT NOT a number (therefore is a number, so we get rid of empty fields) and the Age is >= `65`.

## Comparisons in R (and most other languages too!)

- Most are obvious:
    + `>` (greater than), `>=` (greater than or equal to), and similarly for `<` and `<=`.
- Others are less so:
    + `!=` means Not Equal to...
- Others are confusiong:
    + `==` compares equality. Notice that there are two equal signs. This is because in R `=` means an assigment, you're _making_ somethign equal to something else:
    + `x = 6` means make the variable called `x` equal 6. If you then do `x == 8` is a question, _is_ x equal to 8? Here, the answer is a `FALSE`

## Second Wrangle!

```{r, eval=FALSE, echo=TRUE}
filter(ddata, is.na(Age) == FALSE, Age >= 65) %>% select(Gender)
```

- First filter the rows by two criteria:
    + we only want rows that have an Age variable in them - so exclude ones that are not a number
    + we are also interested in patients 65 and older (`>= 65`)
- Now select the gender column
- What we have left is a single column of Male/Female from a _subset_ of our data - namely ones that have an Age and are 65 and older

## What's that weird sign?!

The `%>%` operator (created by the _dplyr_ library) is called a **pipe**, and it (surprise, surprise) _pipes_ data from one command to the next. So in plain English, the above line _filters_ the data where the Age  is NOT NOT a  number (i.e. is a number!) and that the Age is >= 65, then selects the Gender.

An even better way to write this is ...

```{r, eval=FALSE, echo=TRUE}
ddata %>% filter(is.na(Age) == FALSE, Age >= 65) %>% select(Gender)
```

## What now?

Now that we have our data's _subset_, we can pass it onto other functions in R:

```{r, eval=FALSE, echo=TRUE}
ddata %>% filter(is.na(Age) == FALSE, Age >= 65) %>% select(Gender) %>% summary
```

This says, grab my data labeled `ddata`, filter the rows so that we only find patients who have an Age and are 65 and older, select the column called 'Gender'. With that column, give me a summary.

## What do you think this does?

```{r, eval=FALSE, echo=TRUE}
ddata %>% ddata %>% filter(Age >= 65) %>% select(Gender) %>% is.na %>% sum
```
